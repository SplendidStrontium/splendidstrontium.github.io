{% assign comments = site.data.comments[page.slug] %}
{% if comments and comments.size > 0 %}
<div class="comments-section">
    <h3>Comments</h3>
    
    <!-- Display existing comments using your original working logic -->
    {% assign sorted_comments = comments | sort %}
    <div class="comments-list">
        {% for comment in sorted_comments %}
            {% assign commentData = comment[1] %}
            {% assign commentId = comment[0] %}
            <div class="comment" id="comment-{{ commentId }}">
                <div class="comment-header">
                    <div class="comment-author">
                        {% if commentData.email %}
                            <img src="https://www.gravatar.com/avatar/{{ commentData.email }}?s=40&d=identicon" alt="Avatar" class="comment-avatar">
                        {% else %}
                            <div class="comment-avatar"></div>
                        {% endif %}
                        <strong>{{ commentData.name }}</strong>
                    </div>
                    <div class="comment-meta">
                        <span class="comment-date">{{ commentData.date | date: "%B %d, %Y at %I:%M %p UTC" }}</span>
                        <button class="reply-button" data-parent-id="{{ commentId }}" data-parent-author="{{ commentData.name }}">Reply</button>
                    </div>
                </div>
                <div class="comment-body">
                    {{ commentData.message | markdownify }}
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- Comment submission form -->
    {% include staticman-comment-form.html %}
{% else %}
<div class="comments-section">
    <h3>Comments</h3>
    <p>No comments yet. Be the first to comment!</p>
    
    <!-- Comment submission form -->
    {% include staticman-comment-form.html %}
</div>
{% endif %}